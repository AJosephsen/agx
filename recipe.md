# Langium Workflow Recipe

Follow these steps as you build and evolve our AGX language with Langium. The flow mirrors the official Langium workflow guide and highlights when a step is one-time vs. iterative.

## 1. Install Yeoman (one-time)
- Ensure Node.js 18+ is installed.
- Install Yeoman and the Langium generator globally:
  - `npm install -g yo generator-langium`
- Verify with `yo --version` so the scaffolder is ready.

## 2. Scaffold the project (one-time per repo)
- Run `yo langium` inside the repo root.
- Answer the prompts (language name, package IDs, LSP/CLI support).
- The generator seeds a TypeScript workspace with:
  - Grammar stub in `src/language/*.langium`
  - VS Code extension + CLI skeletons
  - Preconfigured build/test scripts
- Finish by running `npm install` (or `pnpm install`) in the generated workspace.

## 3. Write / update the grammar (iterative)
- Edit the `.langium` grammar to describe new syntax.
- Use the Langium VS Code extension for completion, diagnostics, and quick-fixes.
- Keep grammar focused: declare keywords, rules, terminals, and cross-reference definitions.
- Save often; the extension validates the grammar before generation.

## 4. Generate the AST (per grammar change)
- Run the Langium CLI to regenerate artifacts:
  - `npx langium generate` (or the package script `npm run langium:generate`).
- Generation outputs the strongly-typed AST interfaces and parser code under `src/generated`.
- Treat generated files as build artifacts; never edit them by hand.

## 5. Resolve cross-references (per grammar change)
- Implement `linker`/`scope` services to connect identifiers defined across files.
- Extend `ScopeProvider` or `Linker` to populate scopes for custom name-resolution.
- Replace the placeholder implementations generated by the CLI so references no longer report "unresolved" diagnostics.

## 6. Create validations (per feature)
- Add semantic checks in `ValidationRegistry` / validator modules.
- Express business rules (e.g., uniqueness, range checks, forbidden combos).
- Surface errors or warnings via `accept('error' | 'warning', message, {node, property})`.
- Use validations to guard against structurally valid but semantically wrong documents.

## 7. Generate artifacts (per release cycle)
- Traverse the AST to emit code, configs, docs, or diagrams.
- Common patterns:
  - CLI commands that read `.agx` files and output JSON/TS/PlantUML.
  - VS Code commands that preview generated content.
- Keep generators pure (input file → output) so they can run in CI.

## 8. Explore advanced recipes (as needed)
- When requirements exceed the core loop—custom formatting, incremental builds, language server tweaks—consult Langium's recipe docs: https://langium.org/docs/recipes/
- Capture any project-specific extensions back into this repo for reproducibility.

## Working cycle summary
1. Modify grammar.
2. `langium generate` to refresh AST + services.
3. Adjust cross-reference logic.
4. Extend validations.
5. Update generators / tooling.
6. Rerun tests + sample files.

Repeat the cycle for every new language feature. Commit both grammar updates and the regenerated artifacts so collaborators stay in sync.
